#!/bin/bash

# Get the list of modified, added, deleted, or renamed files
files=$(git diff --name-only -- '*.java')

# If there are no changed files, exit
if [ -z "$files" ]; then
    exit 0
fi

# Run PMD on the changed files
./libs/pmd-bin-6.52.0/bin/run.sh pmd -d "$files" -f text -R pmd/rules.xml | awk '{ print NR ": " $0 }'

# If PMD found any issues, exit with a non-zero code
if [ $? -ne 0 ]; then
    exit 1
fi
